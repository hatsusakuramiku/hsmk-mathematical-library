package simplexIntegral;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.StringJoiner;
import java.util.function.BiFunction;
import simplexIntegral.polygon.Polygon;
import simplexIntegral.polygon.Triangle;
import tools.ArrayTools;

public class TriangleIntegral extends IntegralBase {

    @Override
    protected HashMap<String, Double[][]> initalIntegralFormulas() {
        HashMap<String, Double[][]> formulas = new HashMap<>();

        formulas.put("ORDER3POINT7", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0250000000000000},
            {1.0000000000000000, 0.0000000000000000, 0.0250000000000000},
            {0.0000000000000000, 1.0000000000000000, 0.0250000000000000},
            {0.5000000000000000, 0.0000000000000000, 0.0666666666666667},
            {0.0000000000000000, 0.5000000000000000, 0.0666666666666667},
            {0.5000000000000000, 0.5000000000000000, 0.0666666666666667},
            {1.0000000000000000, 0.5000000000000000, 0.0666666666666667},
            {0.5000000000000000, 1.0000000000000000, 0.0666666666666667},
            {0.3333333333333333, 0.3333333333333333, 0.2250000000000000}
        });

        formulas.put("ORDER3POINT7", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0250000000000000},
            {1.0000000000000000, 0.0000000000000000, 0.0250000000000000},
            {0.0000000000000000, 1.0000000000000000, 0.0250000000000000},
            {0.5000000000000000, 0.0000000000000000, 0.0666666666666667},
            {0.0000000000000000, 0.5000000000000000, 0.0666666666666667},
            {0.5000000000000000, 0.5000000000000000, 0.0666666666666667},
            {1.0000000000000000, 0.5000000000000000, 0.0666666666666667},
            {0.5000000000000000, 1.0000000000000000, 0.0666666666666667},
            {0.3333333333333333, 0.3333333333333333, 0.2250000000000000}
        });

        formulas.put("ORDER5POINT12", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0074364565124103},
            {1.0000000000000000, 0.0000000000000000, 0.0074364565124103},
            {0.0000000000000000, 1.0000000000000000, 0.0074364565124103},
            {0.2934695559090401, 0.0000000000000000, 0.0244208406170255},
            {0.0000000000000000, 0.2934695559090401, 0.0244208406170255},
            {0.7065304440909599, 0.2934695559090401, 0.0244208406170255},
            {0.2934695559090401, 0.7065304440909599, 0.0244208406170255},
            {0.0000000000000000, 0.7065304440909599, 0.0244208406170255},
            {0.7065304440909599, 0.0000000000000000, 0.0244208406170255},
            {0.2073451756635909, 0.2073451756635909, 0.1103885289202054},
            {0.5853096486728182, 0.2073451756635909, 0.1103885289202054},
            {0.2073451756635909, 0.5853096486728182, 0.1103885289202054}
        });

        formulas.put("ORDER7POINT18", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0031746031746032},
            {1.0000000000000000, 0.0000000000000000, 0.0031746031746032},
            {0.0000000000000000, 1.0000000000000000, 0.0031746031746032},
            {0.5000000000000000, 0.0000000000000000, 0.0126984126984127},
            {0.0000000000000000, 0.5000000000000000, 0.0126984126984127},
            {0.5000000000000000, 0.5000000000000000, 0.0126984126984127},
            {1.0000000000000000, 0.5000000000000000, 0.0126984126984127},
            {0.5000000000000000, 1.0000000000000000, 0.0126984126984127},
            {0.2113248654051871, 0.0000000000000000, 0.0091463414634146},
            {0.0000000000000000, 0.2113248654051871, 0.0091463414634146},
            {0.7886751345948129, 0.2113248654051871, 0.0091463414634146},
            {0.2113248654051871, 0.7886751345948129, 0.0091463414634146},
            {0.0000000000000000, 0.7886751345948129, 0.0091463414634146},
            {0.7886751345948129, 0.0000000000000000, 0.0091463414634146},
            {0.4247639617258106, 0.4247639617258106, 0.0787812144693918},
            {0.1504720765483788, 0.4247639617258106, 0.0787812144693918},
            {0.4247639617258106, 0.1504720765483788, 0.0787812144693918},
            {0.1307915938297450, 0.1307915938297450, 0.0505838648956876},
            {0.7384168123405102, 0.1307915938297450, 0.0505838648956876},
            {0.1307915938297450, 0.7384168123405102, 0.0505838648956876}
        });

        formulas.put("ORDER7POINT27", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0007425845258035},
            {1.0000000000000000, 0.0000000000000000, 0.0007425845258035},
            {0.0000000000000000, 1.0000000000000000, 0.0007425845258035},
            {0.5000000000000000, 0.0000000000000000, 0.0005228925775971},
            {0.0000000000000000, 0.5000000000000000, 0.0005228925775971},
            {0.5000000000000000, 0.5000000000000000, 0.0005228925775971},
            {1.0000000000000000, 0.5000000000000000, 0.0005228925775971},
            {0.5000000000000000, 1.0000000000000000, 0.0005228925775971},
            {0.1044413784858067, 0.0000000000000000, 0.0057807445363853},
            {0.0000000000000000, 0.1044413784858067, 0.0057807445363853},
            {0.8955586215141933, 0.1044413784858067, 0.0057807445363853},
            {0.1044413784858067, 0.8955586215141933, 0.0057807445363853},
            {0.0000000000000000, 0.8955586215141933, 0.0057807445363853},
            {0.8955586215141933, 0.0000000000000000, 0.0057807445363853},
            {0.1124612712776796, 0.1124612712776796, 0.0314308670110613},
            {0.7750774574446408, 0.1124612712776796, 0.0314308670110613},
            {0.1124612712776796, 0.7750774574446408, 0.0314308670110613},
            {0.0396463497292108, 0.3373407414205641, 0.0267051637807203},
            {0.3373407414205641, 0.0396463497292108, 0.0267051637807203},
            {0.6230129088502252, 0.3373407414205641, 0.0267051637807203},
            {0.3373407414205641, 0.6230129088502252, 0.0267051637807203},
            {0.0396463497292108, 0.6230129088502252, 0.0267051637807203},
            {0.6230129088502252, 0.0396463497292108, 0.0267051637807203},
            {0.1868572380229495, 0.3156575833835992, 0.0344992529589967},
            {0.3156575833835992, 0.1868572380229495, 0.0344992529589967},
            {0.4974851785934513, 0.3156575833835992, 0.0344992529589967},
            {0.3156575833835992, 0.4974851785934513, 0.0344992529589967},
            {0.1868572380229495, 0.4974851785934513, 0.0344992529589967},
            {0.4974851785934513, 0.1868572380229495, 0.0344992529589967}
        });

        formulas.put("ORDER10POINT30", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0007425845258035},
            {1.0000000000000000, 0.0000000000000000, 0.0007425845258035},
            {0.0000000000000000, 1.0000000000000000, 0.0007425845258035},
            {0.3632980741536860, 0.0000000000000000, 0.0061905650036766},
            {0.0000000000000000, 0.3632980741536860, 0.0061905650036766},
            {0.6367019258463140, 0.3632980741536860, 0.0061905650036766},
            {0.3632980741536860, 0.6367019258463140, 0.0061905650036766},
            {0.0000000000000000, 0.6367019258463140, 0.0061905650036766},
            {0.6367019258463140, 0.0000000000000000, 0.0061905650036766},
            {0.1322645816327140, 0.0000000000000000, 0.0034805786404892},
            {0.0000000000000000, 0.1322645816327140, 0.0034805786404892},
            {0.8677354183672860, 0.1322645816327140, 0.0034805786404892},
            {0.1322645816327140, 0.8677354183672860, 0.0034805786404892},
            {0.0000000000000000, 0.8677354183672860, 0.0034805786404892},
            {0.8677354183672860, 0.0000000000000000, 0.0034805786404892},
            {0.4578368380791611, 0.4578368380791611, 0.0345304303772828},
            {0.0843263238416778, 0.4578368380791611, 0.0345304303772828},
            {0.4578368380791611, 0.0843263238416778, 0.0345304303772828},
            {0.2568591072619591, 0.2568591072619591, 0.0459012376307629},
            {0.4862817854760818, 0.2568591072619591, 0.0459012376307629},
            {0.2568591072619591, 0.4862817854760818, 0.0459012376307629},
            {0.0575276844114101, 0.0575276844114101, 0.0116261354596176},
            {0.8849446311771798, 0.0575276844114101, 0.0116261354596176},
            {0.0575276844114101, 0.8849446311771798, 0.0116261354596176},
            {0.0781925836255170, 0.2210012187598900, 0.0272785759699963},
            {0.2210012187598900, 0.0781925836255170, 0.0272785759699963},
            {0.7008061976145930, 0.2210012187598900, 0.0272785759699963},
            {0.2210012187598900, 0.7008061976145930, 0.0272785759699963},
            {0.0781925836255170, 0.7008061976145930, 0.0272785759699963},
            {0.7008061976145930, 0.0781925836255170, 0.0272785759699963}
        });

        formulas.put("ORDER11POINT36_v1", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0006082563295533},
            {1.0000000000000000, 0.0000000000000000, 0.0006082563295533},
            {0.0000000000000000, 1.0000000000000000, 0.0006082563295533},
            {0.3064211565289040, 0.0000000000000000, 0.0048625513112147},
            {0.0000000000000000, 0.3064211565289040, 0.0048625513112147},
            {0.6935788434710960, 0.3064211565289040, 0.0048625513112147},
            {0.3064211565289040, 0.6935788434710960, 0.0048625513112147},
            {0.0000000000000000, 0.6935788434710960, 0.0048625513112147},
            {0.6935788434710960, 0.0000000000000000, 0.0048625513112147},
            {0.0905511263526759, 0.0000000000000000, 0.0028774888122094},
            {0.0000000000000000, 0.0905511263526759, 0.0028774888122094},
            {0.9094488736473242, 0.0905511263526759, 0.0028774888122094},
            {0.0905511263526759, 0.9094488736473242, 0.0028774888122094},
            {0.0000000000000000, 0.9094488736473242, 0.0028774888122094},
            {0.9094488736473242, 0.0000000000000000, 0.0028774888122094},
            {0.4771441370462489, 0.4771441370462489, 0.0242383109915602},
            {0.0457117259075022, 0.4771441370462489, 0.0242383109915602},
            {0.4771441370462489, 0.0457117259075022, 0.0242383109915602},
            {0.0687757411594241, 0.0687757411594241, 0.0122987832912846},
            {0.8624485176811518, 0.0687757411594241, 0.0122987832912846},
            {0.0687757411594241, 0.8624485176811518, 0.0122987832912846},
            {0.3924791119734775, 0.3924791119734775, 0.0330257830725039},
            {0.2150417760530450, 0.3924791119734775, 0.0330257830725039},
            {0.3924791119734775, 0.2150417760530450, 0.0330257830725039},
            {0.7265336385659892, 0.2115723052694821, 0.0175447940698770},
            {0.2115723052694821, 0.7265336385659892, 0.0175447940698770},
            {0.0618940561645287, 0.2115723052694821, 0.0175447940698770},
            {0.2115723052694821, 0.0618940561645287, 0.0175447940698770},
            {0.7265336385659892, 0.0618940561645287, 0.0175447940698770},
            {0.0618940561645287, 0.7265336385659892, 0.0175447940698770},
            {0.5850352547280820, 0.1437555396489239, 0.0229629322975813},
            {0.1437555396489239, 0.5850352547280820, 0.0229629322975813},
            {0.2712092056229941, 0.1437555396489239, 0.0229629322975813},
            {0.1437555396489239, 0.2712092056229941, 0.0229629322975813},
            {0.5850352547280820, 0.2712092056229941, 0.0229629322975813},
            {0.2712092056229941, 0.5850352547280820, 0.0229629322975813}
        });

        formulas.put("ORDER11POINT36_v2", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0004583058548766},
            {1.0000000000000000, 0.0000000000000000, 0.0004583058548766},
            {0.0000000000000000, 1.0000000000000000, 0.0004583058548766},
            {0.3729607034612477, 0.0000000000000000, 0.0046972763052366},
            {0.0000000000000000, 0.3729607034612477, 0.0046972763052366},
            {0.6270392965387523, 0.3729607034612477, 0.0046972763052366},
            {0.3729607034612477, 0.6270392965387523, 0.0046972763052366},
            {0.0000000000000000, 0.6270392965387523, 0.0046972763052366},
            {0.6270392965387523, 0.0000000000000000, 0.0046972763052366},
            {0.1553066665135477, 0.0000000000000000, 0.0033670704572231},
            {0.0000000000000000, 0.1553066665135477, 0.0033670704572231},
            {0.8446933334864524, 0.1553066665135477, 0.0033670704572231},
            {0.1553066665135477, 0.8446933334864524, 0.0033670704572231},
            {0.0000000000000000, 0.8446933334864524, 0.0033670704572231},
            {0.8446933334864524, 0.0000000000000000, 0.0033670704572231},
            {0.2117511055315521, 0.2117511055315521, 0.0284917708430019},
            {0.5764977889368958, 0.2117511055315521, 0.0284917708430019},
            {0.2117511055315521, 0.5764977889368958, 0.0284917708430019},
            {0.0448261679371473, 0.0448261679371473, 0.0089481039296214},
            {0.9103476641257054, 0.0448261679371473, 0.0089481039296214},
            {0.0448261679371473, 0.9103476641257054, 0.0089481039296214},
            {0.3943145502141118, 0.3943145502141118, 0.0327521043610995},
            {0.2113708995717763, 0.3943145502141118, 0.0327521043610995},
            {0.3943145502141118, 0.2113708995717763, 0.0327521043610995},
            {0.0675702828416059, 0.3686932305165343, 0.0213507461044012},
            {0.3686932305165343, 0.0675702828416059, 0.0213507461044012},
            {0.5637364866418599, 0.3686932305165343, 0.0213507461044012},
            {0.3686932305165343, 0.5637364866418599, 0.0213507461044012},
            {0.0675702828416059, 0.5637364866418599, 0.0213507461044012},
            {0.5637364866418599, 0.0675702828416059, 0.0213507461044012},
            {0.7474371355107265, 0.1845656598467499, 0.0185930979721728},
            {0.1845656598467499, 0.7474371355107265, 0.0185930979721728},
            {0.0679972046425235, 0.1845656598467499, 0.0185930979721728},
            {0.1845656598467499, 0.0679972046425235, 0.0185930979721728},
            {0.7474371355107265, 0.0679972046425235, 0.0185930979721728},
            {0.0679972046425235, 0.7474371355107265, 0.0185930979721728}
        });

        formulas.put("ORDER11POINT36_v3", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0006582643475373},
            {1.0000000000000000, 0.0000000000000000, 0.0006582643475373},
            {0.0000000000000000, 1.0000000000000000, 0.0006582643475373},
            {0.0969088550542737, 0.0000000000000000, 0.0028879977494522},
            {0.0000000000000000, 0.0969088550542737, 0.0028879977494522},
            {0.9030911449457263, 0.0969088550542737, 0.0028879977494522},
            {0.0969088550542737, 0.9030911449457263, 0.0028879977494522},
            {0.0000000000000000, 0.9030911449457263, 0.0028879977494522},
            {0.9030911449457263, 0.0000000000000000, 0.0028879977494522},
            {0.3096278562392895, 0.0000000000000000, 0.0049639094562270},
            {0.0000000000000000, 0.3096278562392895, 0.0049639094562270},
            {0.6903721437607104, 0.3096278562392895, 0.0049639094562270},
            {0.3096278562392895, 0.6903721437607104, 0.0049639094562270},
            {0.0000000000000000, 0.6903721437607104, 0.0049639094562270},
            {0.6903721437607104, 0.0000000000000000, 0.0049639094562270},
            {0.3916553803852403, 0.3916553803852403, 0.0315347076780020},
            {0.2166892392295194, 0.3916553803852403, 0.0315347076780020},
            {0.3916553803852403, 0.2166892392295194, 0.0315347076780020},
            {0.0660992728695290, 0.0660992728695290, 0.0119554710382364},
            {0.8678014542609420, 0.0660992728695290, 0.0119554710382364},
            {0.0660992728695290, 0.8678014542609420, 0.0119554710382364},
            {0.4765910774305102, 0.4765910774305102, 0.0243892349044144},
            {0.0468178451389796, 0.4765910774305102, 0.0243892349044144},
            {0.4765910774305102, 0.0468178451389796, 0.0243892349044144},
            {0.2119280804570003, 0.0654927499224013, 0.0190559214375482},
            {0.0654927499224013, 0.2119280804570003, 0.0190559214375482},
            {0.7225791696205984, 0.0654927499224013, 0.0190559214375482},
            {0.0654927499224013, 0.7225791696205984, 0.0190559214375482},
            {0.2119280804570003, 0.7225791696205984, 0.0190559214375482},
            {0.7225791696205984, 0.2119280804570003, 0.0190559214375482},
            {0.1482693720952231, 0.2753149271480059, 0.0221566657060109},
            {0.2753149271480059, 0.1482693720952231, 0.0221566657060109},
            {0.5764157007567711, 0.2753149271480059, 0.0221566657060109},
            {0.2753149271480059, 0.5764157007567711, 0.0221566657060109},
            {0.1482693720952231, 0.5764157007567711, 0.0221566657060109},
            {0.5764157007567711, 0.1482693720952231, 0.0221566657060109}
        });

        formulas.put("ORDER11POINT36_v4", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0006977749977820},
            {1.0000000000000000, 0.0000000000000000, 0.0006977749977820},
            {0.0000000000000000, 1.0000000000000000, 0.0006977749977820},
            {0.1042032950377326, 0.0000000000000000, 0.0029298459186628},
            {0.0000000000000000, 0.1042032950377326, 0.0029298459186628},
            {0.8957967049622674, 0.1042032950377326, 0.0029298459186628},
            {0.1042032950377326, 0.8957967049622674, 0.0029298459186628},
            {0.0000000000000000, 0.8957967049622674, 0.0029298459186628},
            {0.8957967049622674, 0.0000000000000000, 0.0029298459186628},
            {0.3145461912846608, 0.0000000000000000, 0.0050395000826746},
            {0.0000000000000000, 0.3145461912846608, 0.0050395000826746},
            {0.6854538087153392, 0.3145461912846608, 0.0050395000826746},
            {0.3145461912846608, 0.6854538087153392, 0.0050395000826746},
            {0.0000000000000000, 0.6854538087153392, 0.0050395000826746},
            {0.6854538087153392, 0.0000000000000000, 0.0050395000826746},
            {0.4758221914754834, 0.4758221914754834, 0.0245708810521465},
            {0.0483556170490332, 0.4758221914754834, 0.0245708810521465},
            {0.4758221914754834, 0.0483556170490332, 0.0245708810521465},
            {0.3906745108966545, 0.3906745108966545, 0.0297258561992511},
            {0.2186509782066910, 0.3906745108966545, 0.0297258561992511},
            {0.3906745108966545, 0.2186509782066910, 0.0297258561992511},
            {0.0637576348982216, 0.0637576348982216, 0.0117808944428796},
            {0.8724847302035568, 0.0637576348982216, 0.0117808944428796},
            {0.0637576348982216, 0.8724847302035568, 0.0117808944428796},
            {0.0685670503228613, 0.2129399133002941, 0.0205239905920948},
            {0.2129399133002941, 0.0685670503228613, 0.0205239905920948},
            {0.7184930363768445, 0.2129399133002941, 0.0205239905920948},
            {0.2129399133002941, 0.7184930363768445, 0.0205239905920948},
            {0.0685670503228613, 0.7184930363768445, 0.0205239905920948},
            {0.7184930363768445, 0.0685670503228613, 0.0205239905920948},
            {0.5668085553115408, 0.1535990892761941, 0.0214522933938716},
            {0.1535990892761941, 0.5668085553115408, 0.0214522933938716},
            {0.2795923554122651, 0.1535990892761941, 0.0214522933938716},
            {0.1535990892761941, 0.2795923554122651, 0.0214522933938716},
            {0.5668085553115408, 0.2795923554122651, 0.0214522933938716},
            {0.2795923554122651, 0.5668085553115408, 0.0214522933938716}
        });

        formulas.put("ORDER11POINT36_v5", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0007843097667098},
            {1.0000000000000000, 0.0000000000000000, 0.0007843097667098},
            {0.0000000000000000, 1.0000000000000000, 0.0007843097667098},
            {0.3544815779297824, 0.0000000000000000, 0.0053608067702859},
            {0.0000000000000000, 0.3544815779297824, 0.0053608067702859},
            {0.6455184220702176, 0.3544815779297824, 0.0053608067702859},
            {0.3544815779297824, 0.6455184220702176, 0.0053608067702859},
            {0.0000000000000000, 0.6455184220702176, 0.0053608067702859},
            {0.6455184220702176, 0.0000000000000000, 0.0053608067702859},
            {0.1398215631416714, 0.0000000000000000, 0.0036124239457051},
            {0.0000000000000000, 0.1398215631416714, 0.0036124239457051},
            {0.8601784368583286, 0.1398215631416714, 0.0036124239457051},
            {0.1398215631416714, 0.8601784368583286, 0.0036124239457051},
            {0.0000000000000000, 0.8601784368583286, 0.0036124239457051},
            {0.8601784368583286, 0.0000000000000000, 0.0036124239457051},
            {0.2398646683066885, 0.2398646683066885, 0.0293553821871572},
            {0.5202706633866230, 0.2398646683066885, 0.0293553821871572},
            {0.2398646683066885, 0.5202706633866230, 0.0293553821871572},
            {0.0593984182600346, 0.0593984182600346, 0.0125901694379608},
            {0.8812031634799308, 0.0593984182600346, 0.0125901694379608},
            {0.0593984182600346, 0.8812031634799308, 0.0125901694379608},
            {0.3982780592047566, 0.3982780592047566, 0.0247716285439118},
            {0.2034438815904868, 0.3982780592047566, 0.0247716285439118},
            {0.3982780592047566, 0.2034438815904868, 0.0247716285439118},
            {0.0793883683459147, 0.2240733927557592, 0.0263798375560709},
            {0.2240733927557592, 0.0793883683459147, 0.0263798375560709},
            {0.6965382388983261, 0.2240733927557592, 0.0263798375560709},
            {0.2240733927557592, 0.6965382388983261, 0.0263798375560709},
            {0.0793883683459147, 0.6965382388983261, 0.0263798375560709},
            {0.6965382388983261, 0.0793883683459147, 0.0263798375560709},
            {0.4365216866929358, 0.4976858328596177, 0.0142295200934017},
            {0.4976858328596177, 0.4365216866929358, 0.0142295200934017},
            {0.0657924804474465, 0.4976858328596177, 0.0142295200934017},
            {0.4976858328596177, 0.0657924804474465, 0.0142295200934017},
            {0.4365216866929358, 0.0657924804474465, 0.0142295200934017},
            {0.0657924804474465, 0.4365216866929358, 0.0142295200934017}
        });

        formulas.put("ORDER11POINT36_v6", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0004762675286980},
            {1.0000000000000000, 0.0000000000000000, 0.0004762675286980},
            {0.0000000000000000, 1.0000000000000000, 0.0004762675286980},
            {0.0799387092492577, 0.0000000000000000, 0.0028978413111908},
            {0.0000000000000000, 0.0799387092492577, 0.0028978413111908},
            {0.9200612907507423, 0.0799387092492577, 0.0028978413111908},
            {0.0799387092492577, 0.9200612907507423, 0.0028978413111908},
            {0.0000000000000000, 0.9200612907507423, 0.0028978413111908},
            {0.9200612907507423, 0.0000000000000000, 0.0028978413111908},
            {0.3055529243612937, 0.0000000000000000, 0.0044911243467343},
            {0.0000000000000000, 0.3055529243612937, 0.0044911243467343},
            {0.6944470756387062, 0.3055529243612937, 0.0044911243467343},
            {0.3055529243612937, 0.6944470756387062, 0.0044911243467343},
            {0.0000000000000000, 0.6944470756387062, 0.0044911243467343},
            {0.6944470756387062, 0.0000000000000000, 0.0044911243467343},
            {0.3935851990719148, 0.3935851990719148, 0.0351707857757559},
            {0.2128296018561704, 0.3935851990719148, 0.0351707857757559},
            {0.3935851990719148, 0.2128296018561704, 0.0351707857757559},
            {0.0747330069999382, 0.0747330069999382, 0.0135059053576038},
            {0.8505339860001236, 0.0747330069999382, 0.0135059053576038},
            {0.0747330069999382, 0.8505339860001236, 0.0135059053576038},
            {0.4778706061592321, 0.4778706061592321, 0.0238798240338474},
            {0.0442587876815358, 0.4778706061592321, 0.0238798240338474},
            {0.4778706061592321, 0.0442587876815358, 0.0238798240338474},
            {0.2645456108709536, 0.1360625094869939, 0.0249801420966245},
            {0.1360625094869939, 0.2645456108709536, 0.0249801420966245},
            {0.5993918796420525, 0.1360625094869939, 0.0249801420966245},
            {0.1360625094869939, 0.5993918796420525, 0.0249801420966245},
            {0.2645456108709536, 0.5993918796420525, 0.0249801420966245},
            {0.5993918796420525, 0.2645456108709536, 0.0249801420966245},
            {0.1360625094869939, 0.0519490817706174, 0.0144478342308311},
            {0.0519490817706174, 0.1360625094869939, 0.0144478342308311},
            {0.8119884087423888, 0.0519490817706174, 0.0144478342308311},
            {0.0519490817706174, 0.8119884087423888, 0.0144478342308311},
            {0.1360625094869939, 0.8119884087423888, 0.0144478342308311},
            {0.8119884087423888, 0.1360625094869939, 0.0144478342308311}
        });

        formulas.put("ORDER11POINT36_v7", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0001203429728164},
            {1.0000000000000000, 0.0000000000000000, 0.0001203429728164},
            {0.0000000000000000, 1.0000000000000000, 0.0001203429728164},
            {0.0302225744049997, 0.0000000000000000, 0.0056480704827756},
            {0.0000000000000000, 0.0302225744049997, 0.0056480704827756},
            {0.9697774255950004, 0.0302225744049997, 0.0056480704827756},
            {0.0302225744049997, 0.9697774255950004, 0.0056480704827756},
            {0.0000000000000000, 0.9697774255950004, 0.0056480704827756},
            {0.9697774255950004, 0.0000000000000000, 0.0056480704827756},
            {0.0429240710063566, 0.0000000000000000, 0.0014347428859733},
            {0.0000000000000000, 0.0429240710063566, 0.0014347428859733},
            {0.9570759289936434, 0.0429240710063566, 0.0014347428859733},
            {0.0429240710063566, 0.9570759289936434, 0.0014347428859733},
            {0.0000000000000000, 0.9570759289936434, 0.0014347428859733},
            {0.9570759289936434, 0.0000000000000000, 0.0014347428859733},
            {0.4762621668242898, 0.4762621668242898, 0.0245049745180348},
            {0.0474756663514204, 0.4762621668242898, 0.0245049745180348},
            {0.4762621668242898, 0.0474756663514204, 0.0245049745180348},
            {0.2030717695662224, 0.4673667678466049, 0.0259118774639745},
            {0.4673667678466049, 0.2030717695662224, 0.0259118774639745},
            {0.3295614625871727, 0.4673667678466049, 0.0259118774639745},
            {0.4673667678466049, 0.3295614625871727, 0.0259118774639745},
            {0.2030717695662224, 0.3295614625871727, 0.0259118774639745},
            {0.3295614625871727, 0.2030717695662224, 0.0259118774639745},
            {0.0363525544520276, 0.1150656775801793, 0.0111269081081659},
            {0.1150656775801793, 0.0363525544520276, 0.0111269081081659},
            {0.8485817679677932, 0.1150656775801793, 0.0111269081081659},
            {0.1150656775801793, 0.8485817679677932, 0.0111269081081659},
            {0.0363525544520276, 0.8485817679677932, 0.0111269081081659},
            {0.8485817679677932, 0.0363525544520276, 0.0111269081081659},
            {0.0363525544520276, 0.1150656775801793, 0.0268990756470184},
            {0.1150656775801793, 0.0363525544520276, 0.0268990756470184},
            {0.8485817679677932, 0.1150656775801793, 0.0268990756470184},
            {0.1150656775801793, 0.8485817679677932, 0.0268990756470184},
            {0.0363525544520276, 0.8485817679677932, 0.0268990756470184},
            {0.8485817679677932, 0.0363525544520276, 0.0268990756470184}
        });

        formulas.put("ORDER11POINT36_v8", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.0007892941754415},
            {1.0000000000000000, 0.0000000000000000, 0.0007892941754415},
            {0.0000000000000000, 1.0000000000000000, 0.0007892941754415},
            {0.1484823026200776, 0.0000000000000000, 0.0024381067469574},
            {0.0000000000000000, 0.1484823026200776, 0.0024381067469574},
            {0.8515176973799223, 0.1484823026200776, 0.0024381067469574},
            {0.1484823026200776, 0.8515176973799223, 0.0024381067469574},
            {0.0000000000000000, 0.8515176973799223, 0.0024381067469574},
            {0.8515176973799223, 0.0000000000000000, 0.0024381067469574},
            {0.3388501069491062, 0.0000000000000000, 0.0054773462101729},
            {0.0000000000000000, 0.3388501069491062, 0.0054773462101729},
            {0.6611498930508938, 0.3388501069491062, 0.0054773462101729},
            {0.3388501069491062, 0.6611498930508938, 0.0054773462101729},
            {0.0000000000000000, 0.6611498930508938, 0.0054773462101729},
            {0.6611498930508938, 0.0000000000000000, 0.0054773462101729},
            {0.4701249674269392, 0.4701249674269392, 0.0265603511342661},
            {0.0597500651461216, 0.4701249674269392, 0.0265603511342661},
            {0.4701249674269392, 0.0597500651461216, 0.0265603511342661},
            {0.2246917714197549, 0.0845431331279699, 0.0272139094522740},
            {0.0845431331279699, 0.2246917714197549, 0.0272139094522740},
            {0.6907650954522752, 0.0845431331279699, 0.0272139094522740},
            {0.0845431331279699, 0.6907650954522752, 0.0272139094522740},
            {0.2246917714197549, 0.6907650954522752, 0.0272139094522740},
            {0.6907650954522752, 0.2246917714197549, 0.0272139094522740},
            {0.0848155843519564, 0.0363163988387003, 0.0076844365395074},
            {0.0363163988387003, 0.0848155843519564, 0.0076844365395074},
            {0.8788680168093432, 0.0363163988387003, 0.0076844365395074},
            {0.0363163988387003, 0.8788680168093432, 0.0076844365395074},
            {0.0848155843519564, 0.8788680168093432, 0.0076844365395074},
            {0.8788680168093432, 0.0848155843519564, 0.0076844365395074},
            {0.3148364616424038, 0.4785704481357608, 0.0268447117295677},
            {0.4785704481357608, 0.3148364616424038, 0.0268447117295677},
            {0.2065930902218355, 0.4785704481357608, 0.0268447117295677},
            {0.4785704481357608, 0.2065930902218355, 0.0268447117295677},
            {0.3148364616424038, 0.2065930902218355, 0.0268447117295677},
            {0.2065930902218355, 0.3148364616424038, 0.0268447117295677}
        });

        formulas.put("ORDER1POINT3", new Double[][]{
            {0.0000000000000000, 0.0000000000000000, 0.1666666666666667},
            {1.0000000000000000, 0.0000000000000000, 0.1666666666666667},
            {0.0000000000000000, 1.0000000000000000, 0.1666666666666667}
        });

        return formulas;
    }

    /**
     * Transforms the given points from the integral coordinates to the real
     * coordinates of the given triangle.
     * <p>
     * The integral coordinates are the coordinates of the points in the
     * integral, and the real coordinates are the coordinates of the points in
     * the triangle.
     * <p>
     * The transformation is done with the following formulas:
     * <p>
     * x = x3 + li * (x1 - x3) + lj * (x2 - x3) y = y3 + li * (y1 - y3) + lj *
     * (y2 - y3)
     * <p>
     * where (x1, y1), (x2, y2), and (x3, y3) are the coordinates of the
     * vertices of this triangle, and (li, lj) are the coordinates of the point
     * in the integral.
     * <p>
     *
     * @param triangle the triangle to transform the points to
     * @param integralPoints the points to transform
     * @return the transformed points
     */
    @Override
    protected <T extends Polygon> Double[][] transformPoints(T triangle, Double[][] integralPoints) {
        Double[][] vertices = ArrayTools.pacakageArray(triangle.getVertices());
        Double[][] result = new Double[integralPoints.length][3];
        for (int i = 0; i < integralPoints.length; i++) {
            result[i][0] = vertices[2][0] + integralPoints[i][0] * (vertices[0][0] - vertices[2][0])
                    + integralPoints[i][1] * (vertices[1][0] - vertices[2][0]); // x
            result[i][1] = vertices[2][1] + integralPoints[i][0] * (vertices[0][1] - vertices[2][1])
                    + integralPoints[i][1] * (vertices[1][1] - vertices[2][1]); // y
            result[i][2] = integralPoints[i][2];
        }
        return result;
    }

    /**
     * Converts an array of IntegralPointWithWeight objects into a formatted
     * string representation specific to the triangle simplex.
     * <p>
     * This method takes an array of IntegralPointWithWeight, retrieves the
     * integral points and their weights, and formats them as a string. Each
     * point's coordinates are followed by its weight, separated by commas, and
     * each point-weight pair is separated by a semicolon. The entire sequence
     * is enclosed in square brackets and ends with a semicolon.
     * <p>
     * This string representation is used to describe the integral formula in a
     * human-readable format.
     * <p>
     *
     * @param points the array of IntegralPointWithWeight objects to convert
     * @return the formatted string representation of the integral points and
     * weights
     */
    @Override
    protected String integralFormulaToString(Double[][] pointWithWeights) {

        ArrayList<String> pointAndWeights = new ArrayList<>();
        for (Double[] pointWithWeight : pointWithWeights) {

            pointAndWeights.add(pointWithWeight[0] + ", " + pointWithWeight[1] + ", " + pointWithWeight[2] + ";\n");
        }
        StringJoiner sj = new StringJoiner("", "[", "];");
        Arrays.stream(pointAndWeights.toArray(String[]::new)).forEach(sj::add);
        return sj.toString();
    }

    /**
     * Integrates a bi-variable function over a given triangle using a specified
     * integral formula.
     * <p>
     * The method retrieves the integral formula by name and uses it to perform
     * numerical integration over the triangle. It throws an exception if the
     * specified formula is not found.
     * <p>
     * The supported integral formulas can be found at
     * <a herf="https://hsmkhexo.s3.ap-northeast-1.amazonaws.com/other/%E7%A7%AF%E5%88%86%E5%85%AC%E5%BC%8F%E6%80%BB%E7%BB%93.pdf">online
     * documentation</a>.
     * <p>
     *
     * @param triangle the triangle over which the integration is performed
     * @param func the bi-variable function to integrate
     * @param formulaName the name of the integral formula to use for
     * integration. The available formulas are: "ORDER1POINT3", "ORDER3POINT7",
     * "ORDER5POINT12", "ORDER7POINT18", "ORDER7POINT27", "ORDER10POINT30",
     * "ORDER11POINT36_v1", "ORDER11POINT36_v2", "ORDER11POINT36_v3",
     * "ORDER11POINT36_v4", "ORDER11POINT36_v5", "ORDER11POINT36_v6",
     * "ORDER11POINT36_v7". Or use the method
     * {@link getEnableIntegralFormulaName()} to get all the available formulas.
     * @return the result of the integration
     * @throws IllegalArgumentException if the specified formula is not found
     */
    public double integrate(Triangle triangle, BiFunction<Double, Double, Double> func, String formulaName) {
        return integrate(triangle, func, INTEGRALFORMULAS.get(formulaName));
    }

    /**
     * Integrates a bi-variable function over a given triangle using the
     * specified integral points and weights.
     * <p>
     * The method retrieves the integral points and weights, transforms them
     * into the real coordinates of the triangle, and then applies the function
     * to each point and multiplies the result by its weight. The results are
     * then summed up.
     * <p>
     * The integral points and weights are expected to be in the format of a 2D
     * array of doubles, where each row has 3 elements: the x and y coordinates
     * of the point, and its weight. The array must not be null and must have at
     * least one row. Each row must have exactly 3 elements.
     * <p>
     * The method throws an exception if the function or the integral points and
     * weights are null, or if the integral points and weights array is not in
     * the correct format.
     * <p>
     *
     * @param triangle the triangle over which the integration is performed
     * @param func the bi-variable function to integrate
     * @param pointWithWeights the integral points and weights to use for
     * integration. The array must have 3 elements in each row.
     * @return the result of the integration
     * @throws IllegalArgumentException if the function or the integral points
     * and weights are null, or if the integral points and weights array is not
     * in the correct format
     */
    public double integrate(Triangle triangle, BiFunction<Double, Double, Double> func, Double[][] pointWithWeights) {
        if (func == null || pointWithWeights == null) {
            throw new IllegalArgumentException("The function and pointWithWeights cannot be null.");
        }
        if (pointWithWeights[0].length != 3) {
            throw new IllegalArgumentException("The pointWithWeights array must have 3 elements in each row.");
        }
        return applyArrayAndTimesWithWeightsAndSum(func, transformPoints(triangle, pointWithWeights));
    }

    /**
     * Applies the given bi-function to each point in the given array of points,
     * multiplies the result by the weight of the point, and sums up the
     * results.
     * <p>
     * The given bi-function is applied to the first two elements of each point
     * in the given array of points, and the result is multiplied by the third
     * element of the point, which is the weight of the point. The results are
     * then summed up.
     * <p>
     * This method is used to apply a function to each point in the integral,
     * and calculate the integral.
     * <p>
     *
     * @param func the bi-function to apply
     * @param pointWithWeights the points and their weights to apply the
     * function to
     * @return the sum of the results
     */
    protected double applyArrayAndTimesWithWeightsAndSum(BiFunction<Double, Double, Double> func,
            Double[][] pointWithWeights) {
        double result = 0.0;
        for (Double[] pointWithWeight : pointWithWeights) {
            result += func.apply(pointWithWeight[0], pointWithWeight[1]) * pointWithWeight[2];
        }
        return result;
    }
}
